<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Messaging Consent Form</title>
        <style>
            :root{--bg:#f7fafc;--card:#ffffff;--accent:#0f172a;--muted:#94a3b8}
            html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
            body{background:var(--bg);display:flex;align-items:center;justify-content:center;padding:32px}
            .card{background:var(--card);max-width:900px;width:100%;border-radius:12px;box-shadow:0 6px 24px rgba(2,6,23,0.08);padding:28px}
            h1{margin:0 0 8px 0;font-size:20px;color:var(--accent)}
            p.lead{margin:0 0 18px 0;color:var(--muted)}
            form{display:grid;grid-template-columns:1fr 320px;gap:18px}
            .col{background:transparent}
            label{display:block;font-size:13px;margin-bottom:6px;color:#0b1220}
            input[type="text"],input[type="email"],input[type="tel"],textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef6;font-size:14px}
            .checkbox-row{display:flex;align-items:flex-start;gap:10px}
            .helper{font-size:13px;color:var(--muted);margin-top:6px}
            .actions{display:flex;gap:10px;align-items:center;margin-top:12px}
            button{padding:10px 14px;border-radius:8px;border:0;background:#0f172a;color:#fff;cursor:pointer}
            button.ghost{background:transparent;border:1px solid #cbd5e1;color:var(--accent)}
            .consent-log{background:#f1f5f9;border-radius:8px;padding:12px;font-family:monospace;font-size:13px;color:#0b1220}
            .small{font-size:13px;color:var(--muted)}
            .note{font-size:13px;color:#0b1220;margin-top:10px}
            .footer{grid-column:1/-1;margin-top:18px;border-top:1px dashed #e6eef6;padding-top:12px;display:flex;justify-content:space-between;align-items:center}
            @media (max-width:820px){form{grid-template-columns:1fr} .footer{flex-direction:column;gap:8px}}
        </style>
    </head>
    <body>
        <main class="card" role="main">
            <br>
            <br>
            <h1>Consent to Receive Messaging</h1>
            <p class="lead">Use this form to collect explicit consumer consent to receive messages (email, SMS, push, or other).</p>

            <form id="consentForm" novalidate>
                <div class="col">
                    <label for="fullName">Full name</label>
                    <input id="fullName" name="fullName" type="text" placeholder="Jane Doe" required />

                    <label for="email" style="margin-top:12px">Email address</label>
                    <input id="email" name="email" type="email" placeholder="jane@example.com" required />

                    <label for="phone" style="margin-top:12px">Phone (optional)</label>
                    <input id="phone" name="phone" type="tel" placeholder="(555) 555-5555" />

                    <label for="channels" style="margin-top:12px">Preferred channels</label>
                    <select id="channels" name="channels" multiple size="3">
                        <option value="email">Email</option>
                        <option value="sms">SMS / Text</option>
                        <option value="push">Push Notifications</option>
                    </select>

                    <label for="notes" style="margin-top:12px">Additional notes (optional)</label>
                    <textarea id="notes" name="notes" rows="4" placeholder="e.g., best time to contact"></textarea>
                </div>

                <div class="col">
                    <div style="background:#fbfdff;border:1px solid #e6eef6;padding:14px;border-radius:8px">
                        <strong>Consent statement</strong>
                        <p class="small" style="margin-top:8px">By checking the box below and submitting this form you agree to receive messages from <strong>Context Switching</strong> at the contact information provided. You may opt out at any time. Message frequency and carrier/message rates may apply.</p>

                        <div style="margin-top:12px" class="checkbox-row">
                            <input id="consentCheckbox" type="checkbox" aria-describedby="consentDesc" />
                            <div>
                                <label for="consentCheckbox"><strong>I consent to receive messaging</strong></label>
                                <div id="consentDesc" class="helper">This is explicit consent for communication through the channels selected above.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </main>

        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

        <script>
            function getFormData() {
                const fullName = document.getElementById('fullName').value.trim();
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const channels = Array.from(document.getElementById('channels').selectedOptions).map(o => o.value);
                const notes = document.getElementById('notes').value.trim();
                const apiUrl = "https://api.oneai.cloud/q?"
                return { fullName, email, phone, channels, notes, apiUrl };
            }

            function sendConsentGet(consentRecord, domain) {
                const params = new URLSearchParams(consentRecord).toString();
                const url = domain + "uid=Web&save consent given to recieve messages for " + params;
                $.ajax({
                    url: url,
                    type: "GET",
                    success: function (result) {
                        alert('Consent recorded to server.');
                    }
                });
            }

            document.getElementById('consentCheckbox').addEventListener('change', function () {
                if (!formData.fullName) return alert('Please enter full name.');
                if (!consentChecked) return alert('You must check the consent box to continue.');

                const formData = getFormData();

                if (this.checked) {
                    const consentRecord = {
                        fullName: formData.fullName,
                        email: formData.email,
                        phone: formData.phone || null,
                        consentText: 'User consented to receive messaging from Context Switching via selected channels.'
                    };

                    sendConsentGet(consentRecord, formData.apiUrl);
                }
                else {
                    if (!confirm('Are you sure you want to withdraw consent? This will add a withdrawal record to local storage.')) return;
                    const withdrawal = {
                        id: 'withdrawal_' + Date.now(),
                        timestamp_utc: new Date().toISOString(),
                        userAgent: navigator.userAgent,
                        action: 'withdraw_consent'
                    };
                   sendConsentGet(consentRecord, formData.apiUrl);
                }
            });
        </script>
    </body>
</html>
